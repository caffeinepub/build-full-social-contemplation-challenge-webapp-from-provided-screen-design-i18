{
  "kind": "build_request",
  "title": "Redeploy and verify live build serves correct versioned frontend assets",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Redeploy the application to the live environment and confirm the deployment completes successfully (no deployment error).",
      "target": "unknown",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "redepeloy"
        ]
      },
      "acceptanceCriteria": [
        "A new deployment run completes successfully without errors.",
        "The live app loads (no persistent white screen/spinner) after the redeploy."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure the production (live) frontend build always produces a concrete, unique build version (not a placeholder) and that the deployed HTML contains a non-empty `meta[name=\"app-version\"]` value so the app can reliably detect stale assets.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "redepeloy"
        ]
      },
      "acceptanceCriteria": [
        "In the live environment, `document.querySelector('meta[name=\"app-version\"]').getAttribute('content')` is non-empty and does not contain placeholder patterns (e.g., `$...`, `%VITE_...`, `BUILD_VERSION_PLACEHOLDER`, `VITE_BUILD_TIMESTAMP`).",
        "`frontend/src/generated/appVersion.ts` exports a `BUILD_VERSION` value that is concrete at runtime (never a placeholder string)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "After redeploy, verify that the existing developer diagnostics panel correctly displays version information for troubleshooting stale asset issues.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "redepeloy"
        ]
      },
      "acceptanceCriteria": [
        "With `?dev=true`, the Developer Panel shows a non-empty “Running Version (meta tag)” value (or clearly indicates “(not set)” only if the meta tag truly cannot be stamped).",
        "With `?dev=true`, the Developer Panel shows the “Compiled Build Version” value and it matches the stamped meta-tag value when stamping is functioning."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, or any files under frontend/src/components/ui (compose them instead).",
    "Backend must remain a single Motoko actor in backend/main.mo; only add backend/migration.mo if an upgrade requires state migration."
  ],
  "nonGoals": [
    "Adding new product features unrelated to deployment/versioning.",
    "Changing authentication approach (Internet Identity only)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}